---
title: "life-expectancy"
format: gfm
knitr:
  opts_chunk:
    fig.path: figs/
---

```{r}
library(readr)
library(dplyr)
library(countrycode)
library(priceR)
library(ggplot2)
```

```{r}
life_exp <- read_csv("data/DP_LIVE_11122023092440528.csv")
health_spend <- read_csv("data/SHA_11122023093838475.csv")
```

```{r}
exp2020 <- life_exp |> 
  filter(TIME == 2020 & SUBJECT == "TOT") |> 
  group_by(LOCATION) |> 
  summarise(
    years = Value
  )
```


```{r}
# Plot per capita expenditure

spend2020 <- health_spend |> 
  filter(
    `Financing scheme` == "All financing schemes",
    Function == "Current expenditure on health (all functions)",
    Provider == "All providers",
    Measure == "Per capita, current prices, current PPPs",
  )

full2020 <- full_join(spend2020, exp2020,
          by = "LOCATION")

ggplot(full2020, aes(Value, years)) +
  geom_point() +
  theme_classic()
```

```{r}
# Only government spending

spend2020_govt <- health_spend |> 
  filter(
    `Financing scheme` == "Government/compulsory schemes",
    Provider == "All providers",
    Measure == "Per capita, current prices, current PPPs",
  ) |> 
  group_by(LOCATION) |> 
  summarise(
    total = sum(Value)
  )

full3 <- full_join(spend2020_govt, exp2020,
          by = "LOCATION")

ggplot(full3, aes(total, years)) +
  geom_point() +
  theme_classic()
```




